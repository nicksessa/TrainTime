<!DOCTYPE html>
<html lang="en">
<head>
  <title>Train Time</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  
  <!-- Firebase References -->
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>

  <!-- Moment.js Reference -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  
  
  <style>
    /* We need to add space to the top of the body otherwise the nav will overlap the Jumbotron */
    body {
      margin-top: 50px;
      font-family: 'Roboto', sans-serif;
     font-family: 'Merriweather', serif;
     color: #34495E;
}
 th {
     color: #34495E;
}

 .button {
     width: 140px;
     height: 45px;
     font-family: 'Roboto', sans-serif;
     font-size: 11px;
     text-transform: uppercase;
     letter-spacing: 2.5px;
     font-weight: 500;
     color: #008080;
     color: #34495E;
     background-color: #FEF5E7;
     border: none;
     border-radius: 45px;
     box-shadow: 0px 8px 15px rgba(0, 0, 0, 0.1);
     transition: all 0.3s ease 0s;
     cursor: pointer;
     outline: none;
}
 .button:hover {
     background-color: #2EE59D;
     background-color: #008080;
     box-shadow: 0px 7px 15px rgba(23, 32, 42, 0.3);
     color: #fff;
    /*transform: translateY(-7px);
    */
}

  </style>
</head>
<body>

<nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top">
  <a class="navbar-brand" href="#">Sessa</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="#">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">About</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Link</a>
      </li>    
    </ul>
  </div>  
</nav>

<div class="container">
<div class="jumbotron text-center shadow-lg" style="margin-bottom:0; background-color: #34495E; color: white">
  <h1>Tommy Train Time!</h1>
  <p>Chugga Chugga Chugga Chugga Choo Choo!</p> 
</div>
</div>

<div class="container" style="margin-top:30px">
  <div class="row">
    <div class="col-md-12">
      <!-- Current Train Schedule-->
        <div class="card mb-4 shadow-lg" style="border-color: #34495E">
          <div class="card-header text-white" style="background-color: #34495E">Current Train Schedule</div>
          <div class="card-body">
            <table class="table table-sm table-hover" id='employee-table'>
              <thead>
                <tr>
                  <th scope="col">Train Name</th>
                  <th scope="col">Destination</th>
                  <th scope="col">Frequency (min)</th>
                  <th scope="col">Next Arrival</th>
                  <th scope="col">Minutes Away</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <!-- Add train  -->
        <div class="card mb-4 shadow-lg" style="border-color: #34495E">
          <div class="card-header text-white" style="background-color: #34495E">Add Train</div>
          <div class="card-body">

            <!-- Entry Form -->
            <form>
              <div class="form-group">
                <label for="train-name-input">Train Name</label>
                <input class="form-control" id="train-name-input" placeholder="Thomas the Tank Engine" type="text">
              </div>
              <div class="form-group">
                <label for="destination-input">Destination</label>
                <input class="form-control" id="destination-input" placeholder="Tidmouth Sheds" type="text">
              </div>
              <div class="form-group">
                <label for="start-time-input">First Train Time (HH:mm - 24 hour time)</label>
                <input class="form-control" id="start-time-input" placeholder="09:30 AM" type="text">
              </div>
              <div class="form-group">
                <label for="frequency-input">Frequency (min)</label>
                <input class="form-control" id="frequency-input" placeholder="120" type="text">
              </div>
              <button class="btn button float-left" id="add-train-btn">Submit</button>
            </form>
          </div>
        </div>
      </div>
  </div>
</div>

<div class="jumbotron text-center" style="margin-bottom:0">
  <p>"If more of us valued food and cheer and song above hoarded gold, it would be a merrier world." - J.R.R.Tolkien</p>
</div>

<script>
// 1. Initialize Firebase
var config = {
  apiKey: "AIzaSyA_QypGPkcjPtylRDscf7-HQl8ribnFeIs",
  authDomain: "time-sheet-55009.firebaseapp.com",
  databaseURL: "https://time-sheet-55009.firebaseio.com",
  storageBucket: "time-sheet-55009.appspot.com"
};

firebase.initializeApp(config);

var database = firebase.database();

// 2. Button for adding Employees
$("#add-train-btn").on("click", function(event) {
  event.preventDefault();

  // Grabs user input
  var trainName = $("#train-name-input").val().trim();
  var trainDest = $("#destination-input").val().trim();
  var trainStartTime = moment($("#start-time-input").val().trim(), "MM/DD/YYYY").format("X");
  var trainFrequency = $("#frequency-input").val().trim();

  // Creates local "temporary" object for holding data
  var newTrain = {
    name: trainName,
    destination: trainDest,
    startTime: trainStartTime,
    frequency: trainFrequency
  };

  // Uploads train data to the database
  database.ref().push(newTrain);

  // Logs everything to console
  console.log(newTrain.name);
  console.log(newTrain.destination);
  console.log(newTrain.startTime);
  console.log(newTrain.frequency);

  //alert("train successfully added");

  // Clears all of the text-boxes
  $("#train-name-input").val("");
  $("#destination-input").val("");
  $("#start-time-input").val("");
  $("#frequency-input").val("");
});


// 3. Create Firebase event for adding trains to the database and a row in the html when a user adds an entry
database.ref().on("child_added", function(childSnapshot) {
  console.log(childSnapshot.val());

  // Store everything into a variable.
  var trainName = childSnapshot.val().name;
  var trainDest = childSnapshot.val().destination;
  var trainStartTime = childSnapshot.val().startTime;
  var frequency = childSnapshot.val().frequency;

  // Train Info
  console.log(trainName);
  console.log(trainDest);
  console.log(trainStartTime);
  console.log(frequency);

  // Prettify the train start
  var trainStartPretty = moment.unix(trainStartTime).format("MM/DD/YYYY");

  // Calculate the months worked using hardcore math
  // To calculate the months worked
  //var empMonths = moment().diff(moment(empStart, "X"), "months");
  //console.log(empMonths);

  // Calculate the total billed rate
  //var empBilled = empMonths * empRate;
  //console.log(empBilled);

  // Create the new row
  var newRow = $("<tr>").append(
    $("<td>").text(trainName),
    $("<td>").text(trainDest),
    $("<td>").text(frequency),
    $("<td>").text(trainStartPretty),
    $("<td>").text(empMonths),
    $("<td>").text(empRate),
    $("<td>").text(empBilled)
  );

  // Append the new row to the table
  $("#employee-table > tbody").append(newRow);
});

</script>
</body>
</html>
